const Admin = require("../models/admin.model");
const {
  sendTokenResponse,
  blacklistToken,
  isBlacklistedToken,
} = require("../utils/token");

const login = async (req, res) => {
  const { email, password } = req.body;

  try {
    const admin = await Admin.login(email, password);

    const { password: _, ...adminData } = admin.toObject();

    sendTokenResponse(res, adminData, "Login successful");
  } catch (error) {
    return res.status(400).json({ error: error.message });
  }
};

// Sign up
const signup = async (req, res) => {
  const { email, password } = req.body;

  try {
    const admin = await Admin.signup(email, password);
    sendTokenResponse(res, admin, "Signup successful");
  } catch (error) {
    return res.status(400).json({ error: error.message });
  }
};

// Logout
const logout = (req, res) => {
  const token = req.headers.authorization.split(" ")[1];
  if (token) {
    blacklistToken(token);
  }
  return res.status(200).json({ message: "Logout successful" });
};

module.exports = { login, signup, logout };
